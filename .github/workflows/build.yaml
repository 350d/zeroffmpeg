name: Build FFmpeg for Pi Zero v7.3

on: [workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest
    container:
      image: dockcross/linux-armv6:latest
    env:
      PKG_CONFIG_ALL_STATIC: "1"

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Add armhf architecture & update apt cache
        run: |
          dpkg --add-architecture armhf
          apt-get update

      - name: Install build dependencies for static ARMv6
        run: |
          apt-get install -y \
            libc6-dev:armhf \
            pkg-config \
            libv4l-dev:armhf \
            libdrm-dev:armhf \
            libgnutls28-dev:armhf \
            zlib1g-dev:armhf \
            libasound2-dev:armhf \
            libx264-dev:armhf \
            libopus-dev:armhf \
            libogg-dev:armhf \
            libvorbis-dev:armhf \
            libmp3lame-dev:armhf

      - name: Set up QEMU emulation
        uses: docker/setup-qemu-action@v3
        with:
          platforms: arm

      - name: Make build script executable
        run: chmod +x build-ffmpeg.sh

      - name: Run cross-compilation (static)
        run: ./build-ffmpeg.sh

      - name: Upload static build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: ffmpeg-armv6-static
          path: build/install/bin
